\hypertarget{qvga__lib_2include_2qvga_2pwmsnd_8h_source}{}\doxysection{pwmsnd.\+h}
\label{qvga__lib_2include_2qvga_2pwmsnd_8h_source}\index{lib/qvga\_lib/include/qvga/pwmsnd.h@{lib/qvga\_lib/include/qvga/pwmsnd.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{// ****************************************************************************}}
\DoxyCodeLine{2 \textcolor{comment}{//}}
\DoxyCodeLine{3 \textcolor{comment}{//                                PWM sound output}}
\DoxyCodeLine{4 \textcolor{comment}{//}}
\DoxyCodeLine{5 \textcolor{comment}{// ****************************************************************************}}
\DoxyCodeLine{6 \textcolor{comment}{// Sounds are at format 8-\/bit unsigned (middle at 128), 22050 samples per second, mono}}
\DoxyCodeLine{7 \textcolor{comment}{// PWM cycle is 256: TOP = 255}}
\DoxyCodeLine{8 \textcolor{comment}{// Required PWM clock: 22050*256 = 5644800 Hz}}
\DoxyCodeLine{9 }
\DoxyCodeLine{10 \textcolor{comment}{// ... GP19 ... MOSI + sound output (PWM1 B)}}
\DoxyCodeLine{11 }
\DoxyCodeLine{12 \textcolor{preprocessor}{\#ifndef \_PWMSND\_H}}
\DoxyCodeLine{13 \textcolor{preprocessor}{\#define \_PWMSND\_H}}
\DoxyCodeLine{14 }
\DoxyCodeLine{15 \textcolor{preprocessor}{\#include <stdint.h>}}
\DoxyCodeLine{16 \textcolor{preprocessor}{\#include <stdbool.h>}}
\DoxyCodeLine{17 }
\DoxyCodeLine{18 \textcolor{comment}{//\#define PWMSND\_GPIO   19  // PWM output GPIO pin (0..29)}}
\DoxyCodeLine{19 \textcolor{comment}{//\#define PWMSND\_SLICE  ((PWMSND\_GPIO>>1)\&7) // PWM slice index (=1)}}
\DoxyCodeLine{20 \textcolor{comment}{//\#define PWMSND\_CHAN   (PWMSND\_GPIO\&1) // PWM channel index (=1)}}
\DoxyCodeLine{21 }
\DoxyCodeLine{22 \textcolor{preprocessor}{\#define SOUNDRATE   22050   }\textcolor{comment}{// sound rate [Hz]}}
\DoxyCodeLine{23 \textcolor{preprocessor}{\#define PWMSND\_TOP  255 }\textcolor{comment}{// PRM top (period = PWMSND\_TOP + 1 = 256)}}
\DoxyCodeLine{24 \textcolor{preprocessor}{\#define PWMSND\_CLOCK    (SOUNDRATE*(PWMSND\_TOP+1)) }\textcolor{comment}{// PWM clock (= 22050*256 = 5644800)}}
\DoxyCodeLine{25 }
\DoxyCodeLine{26 \textcolor{preprocessor}{\#define SNDFRAC 10  }\textcolor{comment}{// number of fraction bits}}
\DoxyCodeLine{27 \textcolor{preprocessor}{\#define SNDINT (1<<SNDFRAC) }\textcolor{comment}{// integer part of sound fraction}}
\DoxyCodeLine{28 }
\DoxyCodeLine{29 \textcolor{comment}{// current sound}}
\DoxyCodeLine{30 \textcolor{keyword}{extern} \textcolor{keyword}{const} uint8\_t *CurSound; \textcolor{comment}{// current playing sound}}
\DoxyCodeLine{31 \textcolor{keyword}{extern} \textcolor{keyword}{volatile} \textcolor{keywordtype}{int} SoundCnt;   \textcolor{comment}{// counter of current playing sound (<=0 no sound)}}
\DoxyCodeLine{32 \textcolor{keyword}{extern} \textcolor{keywordtype}{int} SoundInc;        \textcolor{comment}{// pointer increment}}
\DoxyCodeLine{33 \textcolor{keyword}{extern} \textcolor{keyword}{volatile} \textcolor{keywordtype}{int} SoundAcc;   \textcolor{comment}{// pointer accumulator}}
\DoxyCodeLine{34 \textcolor{keyword}{extern} \textcolor{keyword}{const} uint8\_t *NextSound;    \textcolor{comment}{// next sound to play repeated sound}}
\DoxyCodeLine{35 \textcolor{keyword}{extern} \textcolor{keywordtype}{int} NextSoundCnt;    \textcolor{comment}{// counter of next sound (0=no repeated sound)}}
\DoxyCodeLine{36 }
\DoxyCodeLine{37 \textcolor{comment}{// initialize PWM sound output}}
\DoxyCodeLine{38 \textcolor{keywordtype}{void} PWMSndInit();}
\DoxyCodeLine{39 }
\DoxyCodeLine{40 \textcolor{comment}{// output PWM sound (sound must be PCM 8-\/bit mono 22050Hz)}}
\DoxyCodeLine{41 \textcolor{comment}{//  snd = pointer to sound}}
\DoxyCodeLine{42 \textcolor{comment}{//  len = length of sound in number of samples}}
\DoxyCodeLine{43 \textcolor{comment}{//  speed = relative speed (1=normal)}}
\DoxyCodeLine{44 \textcolor{comment}{//  rep = True to repeat sample}}
\DoxyCodeLine{45 \textcolor{keywordtype}{void} PlaySound(\textcolor{keyword}{const} uint8\_t *snd, \textcolor{keywordtype}{int} len, \textcolor{keywordtype}{bool} rep = \textcolor{keyword}{false}, \textcolor{keywordtype}{float} speed = 1.0f);}
\DoxyCodeLine{46 }
\DoxyCodeLine{47 \textcolor{comment}{// stop playing sound}}
\DoxyCodeLine{48 \textcolor{keywordtype}{void} StopSound();}
\DoxyCodeLine{49 }
\DoxyCodeLine{50 \textcolor{comment}{// update sound speed (1=normal speed)}}
\DoxyCodeLine{51 \textcolor{keywordtype}{void} SpeedSound(\textcolor{keywordtype}{float} speed);}
\DoxyCodeLine{52 }
\DoxyCodeLine{53 \textcolor{comment}{// check if playing sound}}
\DoxyCodeLine{54 \textcolor{keywordtype}{bool} PlayingSound();}
\DoxyCodeLine{55 }
\DoxyCodeLine{56 \textcolor{comment}{// set next repeated sound}}
\DoxyCodeLine{57 \textcolor{keywordtype}{void} SetNextSound(\textcolor{keyword}{const} uint8\_t *snd, \textcolor{keywordtype}{int} len);}
\DoxyCodeLine{58 }
\DoxyCodeLine{59 \textcolor{preprocessor}{\#endif }\textcolor{comment}{// \_PWMSND\_H}}

\end{DoxyCode}
